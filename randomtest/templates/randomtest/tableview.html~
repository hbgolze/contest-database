{% extends "./base.html" %}

{% block head %}
<script language="javascript">
function drawprogressbar(percent,color) {
var numpixels=50*percent/100;
document.write("<div style=\"position: relative;line-height: 1em;border: 1px solid black; width: 50px; height=10px;\">");
document.write("<div style=\"height: 1.5em; width: "+ numpixels.toString()+"px; background-color: "+color+";\"></div>");
document.write("</div>");
}
</script>
{% endblock %}

{% block content %}
<h2>My Tests</h2>
<div class="col-md-9">

{% if testcount == 0 %}
You don't have any tests. Start by creating a new test <a href="/createtest/">here</a>.
{% else %}
{% if studentusernames|length > 0 %}
<h3>Students</h3>
<ul>
{% for student in studentusernames %}
<li> <a href="student/{{student}}/">{{student}}</a>
{% endfor %}
</ul>
{% endif %}
<table class="table table-striped">
    <thead>
      <tr>
        <th>Test Name</th>
        <th>Types</th>
	<th>Number of Correct Answers</th>
        <th>Number of Problems</th>
	<th>Progress</th>
	<th>Date Created</th>
	<th>Options</th>
      </tr>
    </thead>
    <tbody>
      {% for tpk,name,types,num_problems_correct,problems_count,created_date,progress in rows %}
      <tr>
        <td><a href="test/{{tpk}}/">{{name}}</a></td>
        <td> {% for type in types %}
	       {{type}}{% if not forloop.last%},{% endif %}
	     {% endfor %}
	</td>
	<td>{{num_problems_correct}}</td>
        <td>{{problems_count}}</td>
	<td><div style="font-size:30%"><script language="javascript">drawprogressbar({{progress}},{% if num_problems_correct == problems_count %} '#339966'{% else %}'#C1E0D1'{% endif %})</script></div></td>
        <td>{{created_date}}</td>
	<td>
	  <form action="edittest/{{tpk}}/" method="post">
	    {% csrf_token %}
	    <button type="submit" name="Edit" value="Edit" class="btn-link">Edit</button>
	  </form>
	</td>
	<td>
	  <a href="viewlatex/{{tpk}}/">View LaTeX</a>
	</td>
	<td>
	  <a href="delete/{{tpk}}/">Delete</a>
	</td>
	<td>
	  <a href="pdftest/{{tpk}}/">View PDF</a>
	</td>
	<td>
	  <a href="archive/{{tpk}}/">Archive</a>
	</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

<h2>Archived Tests</h2>
<table class="table table-striped">
    <thead>
      <tr>
        <th>Test Name</th>
        <th>Types</th>
	<th>Number of Correct Answers</th>
        <th>Number of Problems</th>
	<th>Progress</th>
	<th>Date Created</th>
	<th>Options</th>
      </tr>
    </thead>
    <tbody>
      {% for tpk,name,types,num_problems_correct,problems_count,created_date,progress in arows %}
      <tr>
        <td><a href="test/{{tpk}}/">{{name}}</a></td>
        <td> {% for type in types %}
	       {{type}}{% if not forloop.last%},{% endif %}
	     {% endfor %}
	</td>
	<td>{{num_problems_correct}}</td>
        <td>{{problems_count}}</td>
	<td><div style="font-size:30%"><script language="javascript">drawprogressbar({{progress}},{% if num_problems_correct == problems_count %} '#339966'{% else %}'#C1E0D1'{% endif %})</script></div></td>
        <td>{{created_date}}</td>
	<td>
	  <form action="edittest/{{tpk}}/" method="post">
	    {% csrf_token %}
	    <button type="submit" name="Edit" value="Edit" class="btn-link">Edit</button>
	  </form>
	</td>
	<td>
	  <a href="viewlatex/{{tpk}}/">View LaTeX</a>
	</td>
	<td>
	  <a href="delete/{{tpk}}/">Delete</a>
	</td>
	<td>
	  <a href="pdftest/{{tpk}}/">View PDF</a>
	</td>
	<td>
	  <a href="unarchive/{{tpk}}/">Unarchive</a>
	</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
<div class="col-md-3">
<table class="table table-bordered centered">
<thead>
<tr>
<th colspan="2">
Number of Problems Solved Today:
</th>
</tr>
</thead>
<tbody>
<tr>
<td colspan="2">
<p style="text-align:center;font-size:40px">{{todaycorrect}}</p>
</td>
</tr>
<tr>
<td colspan="2"><b>Previous days:</b></td>
</tr>
{% for day,num in weekcorrect %} <tr><td>{{day}}</td><td>{{num}}</td></tr>{% endfor %}
</tbody>
</table>

<table class="table table-striped">
    <thead>
      <tr>
        <th>Stickied Problems</th>
        <th>Date</th>
      </tr>
    </thead>
    <tbody>
      {% for sticky in stickies %}
      <tr>
        <td><small><a href="test/{{sticky.test_pk}}/#{{sticky.problem_label}}">{{sticky.test_label}}</a>: {{sticky.problem_label}}</small></td>
	<td>
	  <small>{{sticky.sticky_date}}</small>
	</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

<table class="table table-striped">
    <thead>
      <tr>
        <th>Recent Responses</th>
        <th>Date</th>
      </tr>
    </thead>
    <tbody>
      {% for resp in responselog %}
      <tr>
        <td><small><a href="test/{{resp.test_pk}}/#{{resp.problem_label}}">{{resp.test_label}}</a>: {{resp.problem_label}}: {% if resp.correct == 1 %} <p style="color:green">{% else %}<p style="color:red">{% endif %}{{resp.response}}</p></small></td>
	<td>
	  <small>{{resp.modified_date}}</small>
	</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endif %}
{% endblock %}
