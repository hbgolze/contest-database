{% extends "randomtest/base.html" %}


{% block content %}

<script src="//rubaxa.github.io/Sortable/Sortable.js"></script>

<ol class="breadcrumb">
  <li><a href="../../">My Classes</a></li>
  <li class="active">{{my_class.name}}</li>
</ol>

<div class="container-fluid">
  <div class="row">
    <div class="col-sm-3 col-md-2 sidebar">
      <ul class="nav nav-sidebar">
	{% include 'teacher/sidebar.html' with activenav="myclasses" %}
      </ul>
    </div>
    <div class="col-sm-9 col-md-10 main">
      <h2>Edit Class: {{my_class.name}}</h2>
      <p>Drag around problems to reorder them (then click save before making any further changes).</p>
      <h3>Units:</h3>
      <form action="." method="POST" id="units">
        {% csrf_token %}
        <div id="unitList" class="list-group">
	  {% if my_class.units.count > 0 %}
          {% for unit in my_class.units.all %}
          <div class="list-group-item">
            <input type="hidden" name="unitinput" value="unit_{{unit.pk}}">
            <div class="row">
              <div class="col-sm-1 col-md-1 col-lg-1">
                {{forloop.counter}}.
              </div>
              <div class="col-sm-10 col-md-10 col-lg-10">

		<a href="units/{{unit.pk}}/">{{unit.name}}</a>
		{% if unit.unit_objects.count > 0 %}
		<ul>
		  {% for unitobj in unit.unit_objects.all %}
		  {% if unitobj.slidegroup %}
		  <li>Slides: {{unitobj.slidegroup.name}}</li>
		  {% elif unitobj.problemset %}
		  <li>Problem Set: {{unitobj.problemset.name}}</li>
		  {% elif unitobj.test %}
		  <li>Test: {{unitobj.test.name}}</li>
		  {% endif %}
		  {% endfor %}
		</ul>
		{% else %}
		<p><i>You haven't added anything to this unit yet.</i></p>
		{% endif %}
              </div>
              <div class="col-sm-1 col-md-1 col-lg-1">
                <div class="js-remove"><span style="color:red; cursor:pointer">âœ–</span></div>
              </div>
            </div>
          </div>
          {% endfor %}
	  {% else %}
	  <div id="no-units"><p><i>You don't have any units in this class yet.</i></p></div>
	  {% endif %}
        </div>
	
        <button type="button" class="btn btn-default" data-toggle="modal" data-target="#newunit">New Unit</button>
        <button type="submit" class="save btn btn-primary" name="save">Save</button>
      </form>

    </div>
  </div>
</div>


<div class="modal fade" id="newunit" role="dialog">
  <div class="modal-dialog" role="document">
    <form class="modal-content" method="post" action="." id="newunit-form">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">New Unit</h4>
      </div>
      <div class="modal-body">
        {% csrf_token %}
	<div class="row">
	  <div class="col-xs-12">
	    <div class="form-group">
              <label for="unit-name" class="control-label">Unit Name</label>
              <input type="text" class="form-control" id="unit-name" name="unit-name">
            </div>
	  </div>
	</div>
        <div class="modal-footer">
          <button type="submit" name="newunit"  class="btn btn-primary">New Unit</button>
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
    </form>    
  </div>
</div>

	      
<script type="text/javascript">
var editableList = Sortable.create(unitList, {
  filter: '.js-remove',
  onFilter: function (evt) {
    var el = editableList.closest(evt.item); // get dragged item
    el && el.parentNode.removeChild(el);
  }
});





$('#newunit-form').on('submit',function(event) {
    event.preventDefault();
    $.ajax({
        type: 'POST',
        url: 'add-unit/',
        data: $(this).serialize(),
        dataType: 'html',
        success: function(result) {
            $("#newunit").hide();
            $("[data-dismiss=modal]").trigger({ type: "click" });
            $("#no-units").empty()
            $("#unitList").append(result);
            $("#unit-name").val('');
        }
    });
    return false;
});
</script>

{% endblock %}
