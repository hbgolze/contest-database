{% extends "randomtest/base.html" %}


{% block content %}

<script src="//rubaxa.github.io/Sortable/Sortable.js"></script>

<ol class="breadcrumb">
  <li><a href="../../../../">My Classes</a></li>
  <li><a href="../../">{{my_class.name}}</a></li>
  <li class="active">{{unit.name}}</li>
</ol>

<div class="container-fluid">
  <div class="row">
    <div class="col-sm-3 col-md-2 sidebar">
      <ul class="nav nav-sidebar">
	{% include 'teacher/sidebar.html' with activenav="myclasses" %}
      </ul>
    </div>
    <div class="col-sm-9 col-md-10 main">
      <h2>Edit Unit: {{unit.name}}</h2>

      {% if unit.unit_objects.count > 0 %}
      <p>Drag around units to reorder them.</p>
      {% endif %}

      <form action="." method="POST" id="units">
        {% csrf_token %}
        <div id="unitobjectList" class="list-group">
          {% for unitobj in unit.unit_objects.all %}
	  {% include 'teacher/unitobjectsnippet.html' with forcount=forloop.counter unitobj=unitobj %}
          {% endfor %}
        </div>
	

	<span class="dropup">
          <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Add <span class="caret"></span>
          </button>
          <ul class="dropdown-menu" role="menu">
            <li><a href="#slides" data-toggle="modal">Slides</a></li>
            <li><a href="#problemset" data-toggle="modal">Problem Set</a></li>
          </ul>
        </span>
        <button type="submit" class="save btn btn-primary" name="save">Save</button>
      </form>

    </div>
  </div>
</div>


  <div class="modal fade" id="slides" role="dialog">
    <div class="modal-dialog" role="document">

      <div class="modal-content">
        <form method="post" action="." id="slides-form">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title">Add Slides</h4>
          </div>
          <div class="modal-body">
            {% csrf_token %}
            <div class="form-group">
              <label for="slides-name" class="control-label">Name of Slides</label>
              <input type="text" class="form-control" id="slides-name" name="slides-name" required>
            </div>	    
          </div>
          <div class="modal-footer">
            <button type="submit" name="addslides" class="btn btn-primary">Add Slides</button>
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </form>
      </div>
      
    </div>
  </div>
  <div class="modal fade" id="problemset" role="dialog">
    <div class="modal-dialog" role="document">

      <div class="modal-content">
        <form method="post" action="." id="problemset-form">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title">Add Problem Set</h4>
          </div>
          <div class="modal-body">
            {% csrf_token %}
            <div class="form-group">
              <label for="problemset-name" class="control-label">Name of Problem Set</label>
              <input type="text" class="form-control" id="problemset-name" name="problemset-name" required>
	      <label for="problemset-default_point_value">Default Point Value</label>
	      <input type="number" class="form-control" id="problemset-default_point_value" name="problemset-default_point_value" required>
            </div>
          </div>
          <div class="modal-footer">
            <button type="submit" name="addproblemset" class="btn btn-primary">Add Problem Set</button>
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </form>
      </div>

    </div>
  </div>






	      
<script type="text/javascript">
var editableList = Sortable.create(unitobjectList, {
  filter: '.js-remove',
  onFilter: function (evt) {
    var el = editableList.closest(evt.item); // get dragged item
    el && el.parentNode.removeChild(el);
  }
});

$('#problemset-form').on('submit',function(event) {
    event.preventDefault();
    $.ajax({
        type: 'POST',
        url: 'add-problemset/',
        data: $(this).serialize(),
        dataType: 'html',
        success: function(result) {
            $("#problemset").hide();
            $("[data-dismiss=modal]").trigger({ type: "click" });
            $("#unitobjectList").append(result);
            $("#problemset-name").val('');
            $("#problemset-default_point_value").val('');
        }
    });
    return false;
});

$('#slides-form').on('submit',function(event) {
    event.preventDefault();
    $.ajax({
        type: 'POST',
        url: 'add-slides/',
        data: $(this).serialize(),
        dataType: 'html',
        success: function(result) {
            $("#slides").hide();
            $("[data-dismiss=modal]").trigger({ type: "click" });
            $("#unitobjectList").append(result);
            $("#slides-name").val('');

        }
    });
    return false;
});
</script>

{% endblock %}
