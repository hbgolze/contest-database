{% extends "randomtest/base.html" %}

{% block content %}
{% if oneclass %}
<ol class="breadcrumb">
  <li><a href="../../../../../../">My Classes</a></li>
  <li><a href="../../../../">{{problemset.userunitobject.user_unit.user_class.published_class.name}}</a></li>
  <li><a href="../../../">Roster</a></li>
  <li><a href="../../">View Class ({{username}})</a></li>
  <li class="active">{{problemset.userunitobject.user_unit.user_class.published_class.name}} > {{problemset.userunitobject.user_unit.unit.name}} > {{problemset.problemset.name}}</li>
</ol>
{% else %}
<ol class="breadcrumb">
  <li><a href="../../../">My Students</a></li>
  <li><a href="../../">{{username}}'s Classes</a></li>
  <li class="active">{{problemset.userunitobject.user_unit.user_class.published_class.name}} > {{problemset.userunitobject.user_unit.unit.name}} > {{problemset.problemset.name}}</li>
</ol>
{% endif %}

<div class="container">
  <h2>{{problemset.problemset.name}} ({{username}})</h2>
  <div class="row">
    <table class="table table-bordered">
      {% for response_row,start_index in response_rows %}
      {% if not forloop.first %}
      <tr>
	<td style="border-left: 0px solid;{% if not forloop.last %}border-right: 0px solid{% endif %}" colspan="{{response_row|length|add:1}}"></td>
      </tr>
      {% endif %}
      <tr>
	<td>
	  Problem
	</td>
	{% for resp in response_row %}
	<td style="text-align:center">
	  <a href="#{{resp.problem_object.pk}}">{{forloop.counter|add:start_index}}</a>
	</td>
	{% endfor %}
      </tr>
      <tr>
	<td>
	  Status
	</td>
	{% for resp in response_row %}
	<td style="text-align:center">
	  <span id="table-problem-status-{{resp.problem_object.pk}}">
	    {% if resp.attempted %}
	     {% if resp.problem_object.question_type.question_type == "multiple choice" %}
	      {% if resp.problem_object.isProblem == 0 %}
	       {% if resp.response == resp.problem_object.mc_answer %}
	        <span class="glyphicon glyphicon-ok" style="color:green"></span>
	       {% else %}
	        <span class="glyphicon glyphicon-remove" style="color:red"></span>
	       {% endif %}
	      {% else %}
	       {% if resp.response == resp.problem_object.problem.mc_answer %}
	        <span class="glyphicon glyphicon-ok" style="color:green"></span>
	       {% else %}
	        <span class="glyphicon glyphicon-remove" style="color:red"></span>
	       {% endif %}
	      {% endif %}
	     {% elif resp.problem_object.question_type.question_type == "short answer" %}
	      {% if resp.problem_object.isProblem == 0 %}
	       {% if resp.response == resp.problem_object.sa_answer %}
	        <span class="glyphicon glyphicon-ok" style="color:green"></span>
	       {% else %}
	        <span class="glyphicon glyphicon-remove" style="color:red"></span>
	       {% endif %}
	      {% else %}
	       {% if resp.response == resp.problem_object.problem.sa_answer %}
	        <span class="glyphicon glyphicon-ok" style="color:green"></span>
	       {% else %}
	        <span class="glyphicon glyphicon-remove" style="color:red"></span>
	       {% endif %}
	      {% endif %}
             {% elif resp.problem_object.question_type.question_type == "proof" %}
              {% if resp.is_graded %}
		{{resp.points}}/{{resp.point_value}}
              {% else %}
	        <span class="glyphicon glyphicon-hourglass" style="color:orange"></span>
              {% endif %}
	     {% endif %}
	    {% else %}
	    -
	    {% endif %}
	  </span>
	  <span id="table-star-status-{{resp.problem_object.pk}}">
	    {% if resp.stickied %}
	     (<span class="glyphicon glyphicon-star" style="color:#FFD700"></span>)
	    {% endif %}
	  </span>
	</td>
	{% endfor %}
      </tr>
      {% endfor %}
    </table>
  </div>

  <div class="row">
    <form action="." method="POST">
      {% csrf_token %}
      <input type="hidden" name="startform" value="{{pk}}">
      <table>
	{% for resp in rows %}
	{% if resp.problem_object.isProblem %}
	{% if resp.problem_object.question_type.question_type == "multiple choice" %}
	
	{% include "teacher/problemset-panel.html" with question_type=resp.problem_object.question_type.question_type prob_label=resp.problem_object.pk response=resp.response resp=resp problem_display=resp.problem_object.problem.display_mc_problem_text readable_label=resp.problem_object.problem.readable_label answer=resp.problem_object.problem.mc_answer %}
	
	{% else %}
	
	{% include "teacher/problemset-panel.html" with question_type=resp.problem_object.question_type.question_type prob_label=resp.problem_object.pk response=resp.response resp=resp problem_display=resp.problem_object.problem.display_problem_text readable_label=resp.problem_object.problem.readable_label answer=resp.problem_object.problem.sa_answer %}
	
	{% endif %}
	{% else %}
	
	{% if resp.problem_object.question_type.question_type == "multiple choice" %}
	{% include "teacher/problemset-panel.html" with question_type=resp.problem_object.question_type.question_type prob_label=resp.problem_object.pk response=resp.response resp=resp problem_display=resp.problem_object.problem_display answer=resp.problem_object.mc_answer %}
	
	{% elif resp.problem_object.question_type.question_type == "short answer" %}
	{% include "teacher/problemset-panel.html" with question_type=resp.problem_object.question_type.question_type prob_label=resp.problem_object.pk response=resp.response resp=resp problem_display=resp.problem_object.problem_display answer=resp.problem_object.sa_answer %}

	
	{% else %}
	{% include "teacher/problemset-panel.html" with question_type=resp.problem_object.question_type.question_type prob_label=resp.problem_object.pk response=resp.response resp=resp problem_display=resp.problem_object.problem_display %}

	{% endif %}
	{% endif %}
	{% endfor %}
      </table>
    </form>
  </div>
  <div id="solution-placeholder" class="modal fade" role="dialog">
  </div>
  <div id="grade-placeholder" class="modal fade" role="dialog">
  </div>

</div>

<script>


$(".solution-link").click(function(event) {
    event.preventDefault();
    var target = $(this).attr("href");


    $("#solution-placeholder").load(target, function() {
         MathJax.Hub.Queue(["Typeset",MathJax.Hub,"solution-placeholder"]);
         $("#solution-placeholder").modal("show");
    });
});

function triggerModal()
{
   $(document.body).on('click', '.solution-link', function () {
 
      event.preventDefault();
      var target = $(this).attr("href");


      $("#solution-placeholder").load(target, function() {
        MathJax.Hub.Queue(["Typeset",MathJax.Hub,"solution-placeholder"]);
        $("#solution-placeholder").modal("show");
      });
    });
}

$(document).on('click',".grade-link",function(event) {
    event.preventDefault();

    $.ajax({
        type: 'GET',
        url: 'load_grade/',
        data: "&resp_pk="+$(this).attr("id").split('_')[1],
        dataType: 'json',
        success: function(data) {
            $("#grade-placeholder").html(data['modal-html']);
            MathJax.Hub.Queue(["Typeset",MathJax.Hub,"grade-placeholder"]);
            $("#grade-placeholder").modal("show");
        }
    });
    return false;


});
$(document).on('submit',"#edit-grade-form",function(event) {
    event.preventDefault();
    $.ajax({
        type: 'GET',
        url: 'save_grade/',
        data: $(this).serialize(),
        dataType: 'json',
        success: function(data) {
            $("#grading-status-"+data['pk']).html(" ("+data['points']+"/"+data['point_value']+" Points)");
            $("#table-problem-status-"+data['pk']).html(data['points']+"/"+data['point_value']);
            $("#edit-response-modal").hide();
            $("[data-dismiss=modal]").trigger({ type: "click" });
        }
    });
    return false;


});

</script>

{% endblock %}
