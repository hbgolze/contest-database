{% extends 'randomtest/base.html' %}


{% block title %}Problem: {{prob.readable_label}}{% endblock %}
{% block head %}
<script type="text/javascript" src="/static/js/custjquery.init.js"></script>
<script type="text/javascript" src="/static/js/custcore.js"></script>
<script type="text/javascript" src="/static/js/custSelectBox.js"></script>
<script type="text/javascript" src="/static/js/custSelectFilter2.js"></script>
<script type="text/javascript" src="/static/js/custjsi18n.js"></script>
<link href="/static/css/widgets2.css" type="text/css" media="all" rel="stylesheet" />
{% endblock %}
{% block content %}
<ol class="breadcrumb">
  <li><a href="/problemeditor/">Select Type</a></li>
{% for breadurl,breadlabel in breadcrumbs %}
  <li><a href="{{breadurl}}">{{breadlabel}}</a></li>
{% endfor %}
  <li class="active">{{prob.readable_label}}</li>
</ol>
    <h1>{{prob.readable_label}}</h1>
<form method="POST" class="post-form">{% csrf_token %}



{% include "problemeditor/snippetprobtext.html" %}

<div class="form-group">
{% if request.user.is_superuser %}<p><a href="edittext/">Edit LaTeX Code{% if prob.question_type_new.question_type == "multiple choice" %} (including answer choices){% endif %}</a></p>{% endif %}
</div>
{% if form.instance.author_name != '' %}<p>Author: {{form.instance.author_name}}</p>{% endif %}

{% if prob.question_type_new.question_type == "multiple choice" %}
<label>Answer:</label>
<p>{{form.mc_answer}}</p>
{{form.sa_answer.as_hidden}}
{% elif prob.question_type_new.question_type == "short answer" %}
<label>Answer:</label>
<p>{{form.sa_answer}}</p>
{{form.mc_answer.as_hidden}}

{% elif prob.question_type_new.question_type == "multiple choice short answer" %}
<p><label>Answer (Multiple Choice):</label>
{{form.mc_answer}}</p>
<p><label>Answer (Short Answer):</label></p>
<p>{{form.sa_answer}}</p>

{% else %}
{{form.mc_answer.as_hidden}}
{{form.sa_answer.as_hidden}}
{% endif %}


<label>Current Question Type:</label>
<p>
{{prob.question_type_new.question_type}} <small>(<a href="change_question_type">Change</a>)</small>
</p>

<label>Difficulty:</label>
<p>
{{form.difficulty}}
<a href="#difficulty-info" data-toggle="modal"><span class="glyphicon glyphicon-info-sign"></span></a>
</p>

<label>Solutions</label><br>
{% for solution in prob.solutions.all %}
<label>Solution {{forloop.counter}}:</label>
  <p><small>(<a data-target="#edit-solution-placeholder"  class="edit-solution-link" href="edit_solution/{{solution.pk}}/">Edit</a>)</small> {% if request.user.userprofile.user_type_new.name == 'super' or request.user.userprofile.user_type_new.name == 'sitemanager' or request.user.userprofile.user_type_new.name == 'contestmanager' %}<small>(<a data-target="#delete-solution-placeholder"  class="delete-solution-link" href="deletesolution/{{solution.pk}}/">Delete</a>)</small>{% endif %}</p>
{% autoescape off %}  {{solution.display_solution_text|linebreaks}} {% endautoescape %}
  {% endfor %}
  {% if prob.solutions.count == 0 %}<p>No Solutions Yet</p>{% endif %}
  <button type="button" class="btn btn-default" data-toggle="modal" data-target="#solution-mod">New Solution</button>
  <br><br>

<div class="form-group">
  <label for="tags">Tags:</label>
  <p id="tags">
    {{form.tags}}
  </p>
</div>
<div class="form-group">

<p>
  <label>Approvals:</label>
</p>
<p>
{% if prob.approvals.count != 0 %}
<ul>
{% for appr in prob.approvals.all %}
<li>{{appr.author_name}}: {{appr.get_approval_status_display}} <small>(<a href="editreview/{{appr.pk}}/">Edit</a>)</small></li>
{% endfor %}
</ul>
{% else %}
No one has reviewed this problem for approval yet.<br>
{% endif %}
</p>
<p>
<button type="button" class="save btn btn-default" onclick="location.href='newreview/'">New Review</button>
</p>
</div>
    <label>Comments:</label>
<div class="comments-list">
        {% for com in prob.comments.all %}
<div class="media">
<p class="pull-right"><small>{{com.created_date}}</small></p>
<div class="media-body">
<h3 class="media-heading user_name">{{com.author_name}}</h3>
	  <p>{{com.comment_text|linebreaks}}</p>
{% if request.user.is_superuser %}<p><small>(<a href="deletecomment/{{com.pk}}/">Delete</a>)</small></p>{% endif %}

</div>
</div>
        {% endfor %}
</div>
	{% if prob.comments.count == 0 %}<p>No Comments Yet</p>{% endif %}

<button type="button" class="btn btn-default" data-toggle="modal" data-target="#comment-mod">New Comment</button>
	<br><br>
<button type="submit" class="save btn btn-primary">Save</button>
</form>

<div class="modal fade" id="solution-mod" role="dialog">
  <div class="modal-dialog modal-lg" role="document">

    <div class="modal-content">
      <form method="post" action=".">

        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">New Solution</h4>
        </div>
        <div class="modal-body">
          {% csrf_token %}
          <div class="form-group">
            {% include "problemeditor/snippetprobtextans.html" %}
          </div>
          <div class="form-group">
            <label for="new_solution_text" class="control-label">Solution Text</label>
            <textarea class="form-control" min-width="100%" id="codetext" name="new_solution_text" rows="10" required></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" name="addsolution" class="btn btn-primary">Add Solution</button>
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </form>
    </div>

  </div>
</div>

<div class="modal fade" id="comment-mod" role="dialog">
  <div class="modal-dialog modal-lg" role="document">

    <div class="modal-content">
      <form method="post" action=".">

        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">New Comment</h4>
        </div>
        <div class="modal-body">
          {% csrf_token %}
          <div class="form-group">
	    <label for="author_name" class="control-label">Author Name</label>
	    <input type="text" name="author_name" maxlength="50" class="form-control" required>
            <label for="new_comment_text" class="control-label">Comment Text</label>
            <textarea class="form-control" min-width="100%" id="codetext" name="new_comment_text" rows="10" required></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" name="addcomment" class="btn btn-primary">Add Comment</button>
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </form>
    </div>

  </div>
</div>

<div class="modal fade" id="difficulty-info" role="dialog">
  <div class="modal-dialog" role="document">

    <div class="modal-content">

        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Difficulty Guide</h4>
        </div>
        <div class="modal-body">
<ul>
<li>500-700 - AMC 8 Problems 1--10
<li>700-900 - AMC 10 Problems 1--10
<li>900-1100 - AMC 10 Problems 11--20
<li>1100-1300 - AIME Problems 1--4
<li>1300-1500 - AIME Problems 5--8
<li>1500-1700 - AIME Problems 9--12
<li>1700-1900 - AIME Problems 13--15
</ul>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
    </div>

  </div>
</div>


<div class="modal fade" id="edit-solution-placeholder" tabindex="-1" role="dialog">

</div>
<div class="modal fade" id="delete-solution-placeholder" tabindex="-1" role="dialog">

</div>
<script type="text/javascript">


(function($) {
$(".edit-solution-link").click(function(event) {
    event.preventDefault();
    var target = $(this).attr("href");
    $("#edit-solution-placeholder").load(target, function() {
         MathJax.Hub.Queue(["Typeset",MathJax.Hub,"edit-solution-placeholder"]);
         $("#edit-solution-placeholder").modal("show");
    });
});
})(django.jQuery);

(function($) {
$(".delete-solution-link").click(function(event) {
    event.preventDefault();
    var target = $(this).attr("href");
    $("#delete-solution-placeholder").load(target, function() {
         MathJax.Hub.Queue(["Typeset",MathJax.Hub,"delete-solution-placeholder"]);
         $("#delete-solution-placeholder").modal("show");
    });
});
})(django.jQuery);
</script>
{% endblock %}
